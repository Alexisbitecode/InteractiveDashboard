<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3.js CSV Table Example</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th>Category</th>
                <th>Sub-Category</th>
                <th>Profit</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        // Define the width and height of your visualization (optional)
        const width = 800;
        const height = 400;

        // Load the CSV data
        d3.csv("Sample - Superstore.csv").then(function(data) {
            console.log(data); // Add this line for debugging

            // Process the data to group by Category and Sub-Category and calculate total profit
            const groupedData = d3.group(data, d => d.Category, d => d["Sub-Category"]);
            const aggregatedData = Array.from(groupedData, ([category, subCategories]) => ({
                Category: category,
                SubCategory: Array.from(subCategories, ([subCategory, values]) => ({
                    SubCategory: subCategory,
                    Profit: d3.sum(values, d => parseFloat(d.Profit))
                }))
            }));

            console.log(aggregatedData); // Add this line for debugging

            // Sort the data by Profit in descending order
            aggregatedData.forEach(category => {
                category.SubCategory.sort((a, b) => b.Profit - a.Profit);
            });

            // Create rows for the table
            const tableBody = d3.select("#table-body");

            const rows = tableBody.selectAll("tr")
                .data(aggregatedData)
                .enter()
                .append("tr");

            rows.append("td").text(d => d.Category);
            rows.append("td").text(d => d.SubCategory[0].SubCategory); // Display the top Sub-Category
            rows.append("td").text(d => d.SubCategory[0].Profit); // Display the top Profit
        });
    </script>
</body>
</html>
